This is a wildly unsafe and experimental mess.

barrel file if this actually goes somewhere.

If you're wondering, this implementation compiles to one file. It's ridiculous.