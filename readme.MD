This is a wildly unsafe and experimental mess.

barrel file if this actually goes somewhere.

If you're wondering, this implementation compiles to one file.

This was an attempt to make something normal in luanti. But the challenge was deemed impossible almost immediately.